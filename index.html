<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Knife Hit Clone JS</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            touch-action: none; /* –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∂–µ—Å—Ç—ã –±—Ä–∞—É–∑–µ—Ä–∞ */
        }

        #game-container {
            position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        canvas {
            background: linear-gradient(to bottom, #34495e, #2c3e50);
            display: block;
            cursor: crosshair;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* UI –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∫–ª–∏–∫–∏ */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
            color: white;
        }

        .level-info {
            font-size: 24px;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }

        .knives-left {
             display: flex;
             flex-direction: column-reverse;
             gap: 5px;
             align-items: flex-start;
        }
        
        .knife-icon {
            color: #bdc3c7;
            font-size: 20px;
        }
        .knife-icon.active {
            color: #f1c40f;
        }

        #game-over-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none; /* –°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 10;
        }
        
        #game-over-screen h1 { font-size: 40px; margin: 0 0 20px 0; color: #e74c3c; }
        #game-over-screen p { font-size: 24px; }
        #restart-btn {
            margin-top: 30px;
            padding: 15px 30px;
            background: #f1c40f;
            border: none;
            color: #2c3e50;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            pointer-events: auto; /* –ö–Ω–æ–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∫–ª–∏–∫–∏ */
        }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
    
    <div id="ui-layer">
        <div class="level-info">Level: <span id="levelNum">1</span></div>
        <div class="knives-left" id="knivesCounter">
            </div>
    </div>

    <div id="game-over-screen">
        <h1>GAME OVER</h1>
        <p>Score: <span id="finalScore">0</span></p>
        <button id="restart-btn">RESTART</button>
    </div>
</div>

<script>
    // --- –ù–ê–°–¢–†–û–ô–ö–ò –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // –†–∞–∑–º–µ—Ä—ã Canvas (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –ª–æ–≥–∏–∫–∏, –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è CSS)
    const GAME_WIDTH = 480;
    const GAME_HEIGHT = 640;
    canvas.width = GAME_WIDTH;
    canvas.height = GAME_HEIGHT;

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    let gameState = {
        isRunning: false,
        level: 1,
        score: 0,
        knivesToThrow: 7,
        knivesRemaining: 7
    };

    // –û–±—ä–µ–∫—Ç "–ë—Ä–µ–≤–Ω–æ" (Target)
    const target = {
        x: GAME_WIDTH / 2,
        y: GAME_HEIGHT / 3,
        radius: 80,
        angle: 0,
        rotationSpeed: 0.02, // –ë–∞–∑–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (—Ä–∞–¥–∏–∞–Ω—ã –∑–∞ –∫–∞–¥—Ä)
        stuckKnives: [] // –ú–∞—Å—Å–∏–≤ —É–≥–ª–æ–≤, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º–∏ –≤–æ—Ç–∫–Ω—É—Ç—ã –Ω–æ–∂–∏
    };
// –û–±—ä–µ–∫—Ç "–õ–µ—Ç—è—â–∏–π –Ω–æ–∂" (Player Knife)
    const throwKnife = {
        x: GAME_WIDTH / 2,
        y: GAME_HEIGHT - 100,
        width: 14,
        height: 60,
        speed: 25,
        isFlying: false,
        isReady: true
    };

    // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
    const COLORS = {
        log: '#8e44ad',
        logBorder: '#6c3483',
        knifeHandle: '#95a5a6',
        knifeBlade: '#ecf0f1'
    };

    // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É–≥–æ–ª –º–µ–∂–¥—É –Ω–æ–∂–∞–º–∏ (–æ–∫–æ–ª–æ 15 –≥—Ä–∞–¥—É—Å–æ–≤ –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö) –¥–ª—è –∫–æ–ª–ª–∏–∑–∏–∏
    const MIN_ANGLE_DIFF = 0.25; 

    // --- –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ –ò–ì–†–´ ---
    
    function initGame() {
        gameState.level = 1;
        gameState.score = 0;
        setupLevel(gameState.level);
        gameState.isRunning = true;
        document.getElementById('game-over-screen').style.display = 'none';
        updateUI();
        gameLoop();
    }

    function setupLevel(level) {
        gameState.knivesToThrow = 5 + level; // –° –∫–∞–∂–¥—ã–º —É—Ä–æ–≤–Ω–µ–º –±–æ–ª—å—à–µ –Ω–æ–∂–µ–π
        gameState.knivesRemaining = gameState.knivesToThrow;
        target.stuckKnives = [];
        target.angle = 0;

        // –£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ: —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–∞—â–µ–Ω–∏—è
        let baseSpeed = 0.02 + (level * 0.005);
        // –ù–∞ —á–µ—Ç–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö –º–µ–Ω—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        target.rotationSpeed = (level % 2 === 0) ? -baseSpeed : baseSpeed;
        
        throwKnife.y = GAME_HEIGHT - 100;
        throwKnife.isFlying = false;
        throwKnife.isReady = true;
        updateUI();
    }

    function gameLoop() {
        if (!gameState.isRunning) return;

        update();
        draw();
        requestAnimationFrame(gameLoop);
    }

    // --- –õ–û–ì–ò–ö–ê –û–ë–ù–û–í–õ–ï–ù–ò–Ø (UPDATE) ---

    function update() {
        // 1. –í—Ä–∞—â–µ–Ω–∏–µ –±—Ä–µ–≤–Ω–∞
        target.angle += target.rotationSpeed;

        // 2. –õ–æ–≥–∏–∫–∞ –ª–µ—Ç—è—â–µ–≥–æ –Ω–æ–∂–∞
        if (throwKnife.isFlying) {
            throwKnife.y -= throwKnife.speed;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –±—Ä–µ–≤–Ω–æ
            // –ö–æ–Ω—á–∏–∫ –Ω–æ–∂–∞ (throwKnife.y) –¥–æ—Å—Ç–∏–≥ –Ω–∏–∂–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã –±—Ä–µ–≤–Ω–∞ (target.y + target.radius)
            if (throwKnife.y <= target.y + target.radius) {
                checkCollision();
            }
        }
    }

    // –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ø–∞–¥–∞–Ω–∏—è
    function checkCollision() {
        throwKnife.isFlying = false;

        // –í—ã—á–∏—Å–ª—è–µ–º —É–≥–æ–ª —É–¥–∞—Ä–∞. 
        // –í–∞–∂–Ω–æ: —É–≥–æ–ª —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¢–ï–ö–£–©–ï–ì–û –ø–æ–≤–æ—Ä–æ—Ç–∞ –±—Ä–µ–≤–Ω–∞.
        // Math.PI / 2 –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ—Ç —Ç–æ, —á—Ç–æ –Ω–æ–∂ –ª–µ—Ç–∏—Ç —Å–Ω–∏–∑—É (—Å 90 –≥—Ä–∞–¥—É—Å–æ–≤ –∏–ª–∏ PI/2).
        let impactAngle = (Math.PI / 2) - target.angle;
        
        // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —É–≥–æ–ª –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [0, 2*PI] –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        impactAngle = normalizeAngle(impactAngle);

        // –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø–æ–ø–∞–ª–∏ –ª–∏ –º—ã –≤ –¥—Ä—É–≥–æ–π –Ω–æ–∂?
        for (let stuckAngle of target.stuckKnives) {
            let diff = Math.abs(normalizeAngle(stuckAngle) - impactAngle);
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–Ω–∏—Ü—ã —É–≥–ª–æ–≤ —Å —É—á–µ—Ç–æ–º –ø–µ—Ä–µ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ 0/360 –≥—Ä–∞–¥—É—Å–æ–≤
            if (diff < MIN_ANGLE_DIFF || diff > (Math.PI * 2 - MIN_ANGLE_DIFF)) {
                gameOver();
                return;
            }
        }

        // –£–°–ü–ï–®–ù–û–ï –ü–û–ü–ê–î–ê–ù–ò–ï
        // –î–æ–±–∞–≤–ª—è–µ–º —É–≥–æ–ª –≤ –º–∞—Å—Å–∏–≤ –≤–æ—Ç–∫–Ω—É—Ç—ã—Ö –Ω–æ–∂–µ–π
        target.stuckKnives.push(impactAngle);
        gameState.score++;
        gameState.knivesRemaining--;
        updateUI();

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
        if (gameState.knivesRemaining <= 0) {
            gameState.level++;
            setupLevel(gameState.level);
            // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –±—Ä–æ—Å–∫–æ–º
            throwKnife.isReady = false;
            setTimeout(() => { throwKnife.isReady = true; }, 500);
        } else {
            // –†–µ—Å–µ—Ç –Ω–æ–∂–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –±—Ä–æ—Å–∫–∞
            throwKnife.y = GAME_HEIGHT - 100;
            throwKnife.isReady = true;
        }
    }

    function gameOver() {
        gameState.isRunning = false;
        document.getElementById('finalScore').textContent = gameState.score;
        document.getElementById('game-over-screen').style.display = 'flex';
        // –í–∏–±—Ä–∞—Ü–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
        if (navigator.vibrate) navigator.vibrate(200);
    }
// --- –õ–û–ì–ò–ö–ê –û–¢–†–ò–°–û–í–ö–ò (DRAW) ---

    function draw() {
        ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);

        drawTarget();
        drawFlyingKnife();
    }

    function drawTarget() {
        ctx.save();
        // –ü–µ—Ä–µ–Ω–æ—Å–∏–º —Ç–æ—á–∫—É –æ—Ç—Å—á–µ—Ç–∞ –≤ —Ü–µ–Ω—Ç—Ä –±—Ä–µ–≤–Ω–∞
        ctx.translate(target.x, target.y);
        // –í—Ä–∞—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
        ctx.rotate(target.angle);

        // 1. –†–∏—Å—É–µ–º —Å–∞–º–æ –±—Ä–µ–≤–Ω–æ (–∫—Ä—É–≥)
        ctx.beginPath();
        ctx.arc(0, 0, target.radius, 0, Math.PI * 2);
        ctx.fillStyle = COLORS.log;
        ctx.fill();
        ctx.lineWidth = 6;
        ctx.strokeStyle = COLORS.logBorder;
        ctx.stroke();
        ctx.closePath();
        
        // –î–µ–∫–æ—Ä –±—Ä–µ–≤–Ω–∞ (—á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –≤—Ä–∞—â–µ–Ω–∏–µ)
        ctx.beginPath();
        ctx.arc(0, 0, target.radius / 2, 0, Math.PI * 2);
        ctx.strokeStyle = 'rgba(0,0,0,0.1)';
        ctx.stroke();
        for(let i=0; i<8; i++) {
            ctx.rotate(Math.PI/4);
            ctx.fillStyle = 'rgba(0,0,0,0.1)';
            ctx.fillRect(target.radius - 20, -2, 15, 4);
        }

        // 2. –†–∏—Å—É–µ–º –≤–æ—Ç–∫–Ω—É—Ç—ã–µ –Ω–æ–∂–∏
        target.stuckKnives.forEach(angle => {
            ctx.save();
            ctx.rotate(angle); // –ü–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∞ —É–≥–æ–ª, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º –Ω–æ–∂ –≤–æ—Ç–∫–Ω—É–ª—Å—è
            drawKnifeSprite(0, target.radius); // –†–∏—Å—É–µ–º –Ω–æ–∂ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ –∫—Ä—É–≥–∞
            ctx.restore();
        });

        ctx.restore();
    }

    function drawFlyingKnife() {
        if (throwKnife.isReady || throwKnife.isFlying) {
            // –†–∏—Å—É–µ–º –ª–µ—Ç—è—â–∏–π –Ω–æ–∂ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–Ω—Ç—Ä–∞ —ç–∫—Ä–∞–Ω–∞ –ø–æ X
            drawKnifeSprite(target.x, throwKnife.y);
        }
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è —Ñ–æ—Ä–º—ã –Ω–æ–∂–∞
    // (–†–∏—Å—É–µ—Ç –Ω–æ–∂, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≤–≤–µ—Ä—Ö, —Å —Ü–µ–Ω—Ç—Ä–æ–º –≤ –∑–∞–¥–∞–Ω–Ω–æ–π —Ç–æ—á–∫–µ x, y)
    function drawKnifeSprite(x, y) {
        ctx.save();
        ctx.translate(x, y);
        
        // –õ–µ–∑–≤–∏–µ
        ctx.fillStyle = COLORS.knifeBlade;
        ctx.beginPath();
        ctx.moveTo(-throwKnife.width/2, 0);
        ctx.lineTo(throwKnife.width/2, 0);
        ctx.lineTo(0, -throwKnife.height); // –û—Å—Ç—Ä–∏–µ
        ctx.closePath();
        ctx.fill();

        // –†—É–∫–æ—è—Ç—å
        ctx.fillStyle = COLORS.knifeHandle;
        ctx.fillRect(-throwKnife.width/2 + 2, 0, throwKnife.width - 4, 25);
        
        ctx.restore();
    }


    // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò UI ---

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞/—Ç–∞–ø–∞ –¥–ª—è –±—Ä–æ—Å–∫–∞
    function handleInput(e) {
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∑—É–º –ø–æ –¥–≤–æ–π–Ω–æ–º—É —Ç–∞–ø—É –∏ –ø—Ä–æ–∫—Ä—É—Ç–∫—É
        if(e.cancelable && e.type === 'touchstart') e.preventDefault();

        if (gameState.isRunning && throwKnife.isReady && !throwKnife.isFlying) {
            throwKnife.isFlying = true;
            throwKnife.isReady = false;
        }
    }

    canvas.addEventListener('mousedown', handleInput);
    canvas.addEventListener('touchstart', handleInput, { passive: false });
    document.getElementById('restart-btn').addEventListener('click', initGame);

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (—Å—á–µ—Ç—á–∏–∫ –Ω–æ–∂–µ–π)
    function updateUI() {
        document.getElementById('levelNum').textContent = gameState.level;
        
        const knivesContainer = document.getElementById('knivesCounter');
        knivesContainer.innerHTML = '';
        for (let i = 0; i < gameState.knivesToThrow; i++) {
            const icon = document.createElement('div');
            icon.className = 'knife-icon' + (i < gameState.knivesRemaining ? ' active' : '');
            icon.innerHTML = 'üó°Ô∏è'; // –ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É
            knivesContainer.appendChild(icon);
        }
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è
    function normalizeAngle(angle) {
        angle = angle % (Math.PI * 2);
        if (angle < 0) angle += Math.PI * 2;
        return angle;
    }

    // –ó–ê–ü–£–°–ö –ò–ì–†–´
    initGame();

</script>
</body>
</html>
