<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Knife Hit - Perfect Physics</title>
    <style>
        body {
            margin: 0; padding: 0; background-color: #1a1a1a;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; overflow: hidden; font-family: 'Arial', sans-serif;
            touch-action: none;
        }
        #game-container { position: relative; }
        canvas { background: #2c3e50; display: block; cursor: pointer; border-radius: 10px; }
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: flex; flex-direction: column;
            justify-content: space-between; padding: 20px; box-sizing: border-box; color: white;
        }
        .level-info { font-size: 28px; font-weight: bold; }
        .knives-left { display: flex; flex-direction: column-reverse; gap: 8px; }
        .knife-icon { font-size: 24px; opacity: 0.2; transition: 0.3s; }
        .knife-icon.active { opacity: 1; filter: drop-shadow(0 0 5px gold); }
        #game-over {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none; flex-direction: column;
            justify-content: center; align-items: center; color: white; z-index: 10;
        }
        button {
            margin-top: 20px; padding: 15px 40px; background: #f1c40f;
            border: none; color: #2c3e50; font-size: 20px; font-weight: bold;
            cursor: pointer; border-radius: 50px; pointer-events: auto;
        }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
    <div id="ui-layer">
        <div class="level-info">LVL: <span id="levelNum">1</span></div>
        <div class="knives-left" id="knivesCounter"></div>
    </div>
    <div id="game-over">
        <h1>GAME OVER</h1>
        <p>Score: <span id="finalScore">0</span></p>
        <button onclick="initGame()">RESTART</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 450;
    canvas.height = 700;

    let gameState = {
        isRunning: false,
        level: 1,
        score: 0,
        knivesRemaining: 0
    };

    const target = {
        x: canvas.width / 2,
        y: 220,
        radius: 90,
        rotation: 0,
        speed: 0.03,
        stuckKnives: [], // –ú–∞—Å—Å–∏–≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö —É–≥–ª–æ–≤
        shake: 0
    };

    const knife = {
        x: canvas.width / 2,
        y: canvas.height - 120,
        w: 12,
        h: 80,
        speed: 35,
        isFlying: false
    };

    function initGame() {
        gameState.level = 1;
        gameState.score = 0;
        setupLevel(1);
        gameState.isRunning = true;
        document.getElementById('game-over').style.display = 'none';
        requestAnimationFrame(gameLoop);
    }

    function setupLevel(lvl) {
        gameState.knivesRemaining = 5 + lvl;
        target.stuckKnives = [];
        target.speed = 0.02 + (lvl * 0.01);
        if (lvl % 2 === 0) target.speed *= -1;
        updateUI();
    }

    function update() {
        if (!gameState.isRunning) return;

        // –í—Ä–∞—â–∞–µ–º –º–∏—à–µ–Ω—å
        target.rotation += target.speed;
        
        // –ó–∞—Ç—É—Ö–∞–Ω–∏–µ —Ç—Ä—è—Å–∫–∏
        if (target.shake > 0) target.shake -= 0.5;

        if (knife.isFlying) {
            knife.y -= knife.speed;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Å–∞–Ω–∏—è –Ω–∏–∂–Ω–µ–π —Ç–æ—á–∫–∏ –º–∏—à–µ–Ω–∏
            if (knife.y <= target.y + target.radius) {
                processHit();
            }
        }
    }

    function processHit() {
        knife.isFlying = false;
// –í–´–ß–ò–°–õ–ï–ù–ò–ï –£–ì–õ–ê:
        // –ù–∞–º –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å, –ø–æ–¥ –∫–∞–∫–∏–º —É–≥–ª–æ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¶–ï–ù–¢–†–ê –º–∏—à–µ–Ω–∏ —Å–µ–π—á–∞—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è 
        // —Ç–æ—á–∫–∞ "6 —á–∞—Å–æ–≤" (–Ω–∏–∑ –º–∏—à–µ–Ω–∏), —É—á–∏—Ç—ã–≤–∞—è —Ç–µ–∫—É—â–∏–π –ø–æ–≤–æ—Ä–æ—Ç –º–∏—à–µ–Ω–∏.
        // –í Canvas PI/2 ‚Äî —ç—Ç–æ –Ω–∏–∑. –ú—ã –≤—ã—á–∏—Ç–∞–µ–º —Ç–µ–∫—É—â–∏–π –ø–æ–≤–æ—Ä–æ—Ç –º–∏—à–µ–Ω–∏, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å 
        // "–ª–æ–∫–∞–ª—å–Ω—ã–π" —É–≥–æ–ª –¥–ª—è —ç—Ç–æ–π —Ç–æ—á–∫–∏.
        let hitAngle = (Math.PI / 2) - target.rotation;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –Ω–æ–∂–∞–º–∏
        const hitZone = 0.25; // –®–∏—Ä–∏–Ω–∞ –Ω–æ–∂–∞ –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö
        for (let angle of target.stuckKnives) {
            let diff = Math.abs(normalize(angle) - normalize(hitAngle));
            if (diff < hitZone || diff > (Math.PI * 2 - hitZone)) {
                gameOver();
                return;
            }
        }

        // –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–ø–∞–¥–∞–Ω–∏–µ
        target.stuckKnives.push(hitAngle);
        target.shake = 10;
        gameState.score++;
        gameState.knivesRemaining--;
        updateUI();

        if (gameState.knivesRemaining <= 0) {
            setTimeout(() => {
                gameState.level++;
                setupLevel(gameState.level);
            }, 150);
        }
        
        knife.y = canvas.height - 120;
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. –†–∏—Å—É–µ–º –º–∏—à–µ–Ω—å
        ctx.save();
        ctx.translate(target.x, target.y + (target.shake ? Math.sin(Date.now()) * target.shake : 0));
        
        // –í—Ä–∞—â–∞–µ–º –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–∏—à–µ–Ω–∏ (–∏ –¥–µ—Ä–µ–≤–æ, –∏ –Ω–æ–∂–∏)
        ctx.rotate(target.rotation);

        // –†–∏—Å—É–µ–º –±—Ä–µ–≤–Ω–æ
        ctx.beginPath();
        ctx.arc(0, 0, target.radius, 0, Math.PI * 2);
        ctx.fillStyle = '#8b4513';
        ctx.fill();
        ctx.strokeStyle = '#5d2e0a';
        ctx.lineWidth = 10;
        ctx.stroke();
        
        // –ö–æ–ª—å—Ü–∞ –Ω–∞ –¥–µ—Ä–µ–≤–µ
        ctx.beginPath();
        ctx.arc(0, 0, target.radius - 20, 0, Math.PI * 2);
        ctx.strokeStyle = 'rgba(0,0,0,0.1)';
        ctx.stroke();

        // 2. –†–∏—Å—É–µ–º –≤–æ—Ç–∫–Ω—É—Ç—ã–µ –Ω–æ–∂–∏
        target.stuckKnives.forEach(angle => {
            ctx.save();
            // –ü–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–æ–∂ –Ω–∞ –µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —É–≥–æ–ª –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –º–∏—à–µ–Ω–∏
            ctx.rotate(angle);
            // –°–¥–≤–∏–≥–∞–µ–º –∫ –∫—Ä–∞—é –º–∏—à–µ–Ω–∏
            ctx.translate(0, target.radius);
            drawKnifeGraphic();
            ctx.restore();
        });

        ctx.restore();

        // 3. –†–∏—Å—É–µ–º –Ω–æ–∂ –∏–≥—Ä–æ–∫–∞ (–ª–µ—Ç—è—â–∏–π –∏–ª–∏ –≥–æ—Ç–æ–≤—ã–π)
        if (!knife.isFlying || knife.y > target.y) {
            ctx.save();
            ctx.translate(knife.x, knife.y);
            // –ù–æ–∂ –∏–≥—Ä–æ–∫–∞ –≤—Å–µ–≥–¥–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –≤–≤–µ—Ä—Ö
            ctx.rotate(Math.PI); 
            drawKnifeGraphic();
            ctx.restore();
        }
    }

    function drawKnifeGraphic() {
        // –õ–µ–∑–≤–∏–µ
        ctx.fillStyle = '#bdc3c7';
        ctx.beginPath();
        ctx.moveTo(-6, 0);
        ctx.lineTo(6, 0);
        ctx.lineTo(0, 60);
        ctx.fill();
        // –†—É–∫–æ—è—Ç–∫–∞
        ctx.fillStyle = '#e67e22';
        ctx.fillRect(-6, -20, 12, 25);
    }

    function gameLoop() {
        update();
        draw();
        if (gameState.isRunning) requestAnimationFrame(gameLoop);
    }

    function gameOver() {
        gameState.isRunning = false;
        document.getElementById('finalScore').textContent = gameState.score;
        document.getElementById('game-over').style.display = 'flex';
    }

    function updateUI() {
        document.getElementById('levelNum').textContent = gameState.level;
        const container = document.getElementById('knivesCounter');
        container.innerHTML = '';
        for (let i = 0; i < gameState.knivesRemaining + (knife.isFlying ? 1 : 0); i++) {
            const div = document.createElement('div');
            div.className = 'knife-icon active';
            div.innerHTML = 'üó°Ô∏è';
            container.appendChild(div);
        }
    }

    function normalize(a) {
        a = a % (Math.PI * 2);
        if (a < 0) a += Math.PI * 2;
        return a;
    }
const startThrow = (e) => {
        if (e.cancelable) e.preventDefault();
        if (!knife.isFlying && gameState.isRunning) {
            knife.isFlying = true;
        }
    };

    canvas.addEventListener('mousedown', startThrow);
    canvas.addEventListener('touchstart', startThrow, {passive: false});

    initGame();
</script>
</body>
</html>
