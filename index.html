<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Block Buster Fix</title>
    <style>
        body { background: #222; color: #fff; text-align: center; font-family: sans-serif; }
        canvas { background: #000; border: 2px solid #555; display: block; margin: 20px auto; }
        button { padding: 10px 20px; font-size: 18px; cursor: pointer; background: #00FFDD; border: none; border-radius: 5px; }
    </style>
</head>
<body>

    <h2>Счет: <span id="score">0</span></h2>
    <canvas id="game" width="600" height="400"></canvas>
    <button onclick="startGame()">ИГРАТЬ</button>

<script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");

    let score = 0;
    let running = false;

    // Мяч
    let x = 300, y = 350;
    let dx = 3, dy = -3;
    const ballRadius = 10;

    // Платформа
    const pWidth = 100, pHeight = 10;
    let pX = 250;

    // Блоки
    const bricks = [];
    for(let c=0; c<6; c++) {
        bricks[c] = [];
        for(let r=0; r<4; r++) {
            bricks[c][r] = { x: 0, y: 0, status: 1 };
        }
    }

    // Движение мыши
    canvas.addEventListener("mousemove", (e) => {
        const rect = canvas.getBoundingClientRect();
        pX = e.clientX - rect.left - pWidth/2;
    });

    function startGame() {
        if (!running) {
            running = true;
            requestAnimationFrame(draw);
        }
    }

    function draw() {
        if (!running) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Рисуем блоки
        for(let c=0; c<6; c++) {
            for(let r=0; r<4; r++) {
                if(bricks[c][r].status === 1) {
                    let bx = c*90 + 35;
                    let by = r*30 + 50;
                    bricks[c][r].x = bx;
                    bricks[c][r].y = by;
                    ctx.fillStyle = "#FF5555";
                    ctx.fillRect(bx, by, 80, 20);

                    // Проверка столкновения с блоком
                    if(x > bx && x < bx+80 && y > by && y < by+20) {
                        dy = -dy;
                        bricks[c][r].status = 0;
                        score++;
                        scoreEl.innerText = score;
                    }
                }
            }
        }

        // Рисуем платформу
        ctx.fillStyle = "#00FFDD";
        ctx.fillRect(pX, canvas.height - 20, pWidth, pHeight);

        // Рисуем мяч
        ctx.beginPath();
        ctx.arc(x, y, ballRadius, 0, Math.PI*2);
        ctx.fillStyle = "#FFFFFF";
        ctx.fill();
        ctx.closePath();

        // Физика стен
        if(x + dx > canvas.width || x + dx < 0) dx = -dx;
        if(y + dy < 0) dy = -dy;
        else if(y + dy > canvas.height - 20) {
            if(x > pX && x < pX + pWidth) dy = -dy;
            else {
                alert("ИГРА ОКОНЧЕНА!");
                document.location.reload();
                return;
            }
        }

        x += dx; y += dy;
        requestAnimationFrame(draw);
    }

    // Отрисовать начальный кадр сразу
    ctx.fillStyle = "white";
    ctx.font = "20px Arial";
    ctx.textAlign = "center";
    ctx.fillText("Нажми кнопку START ниже", 300, 200);
</script>
</body>
</html>
